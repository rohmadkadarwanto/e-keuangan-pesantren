"use strict";var __awaiter=this&&this.__awaiter||function(a,e,t,n){return new(t||(t=Promise))(function(i,s){function u(a){try{l(n.next(a))}catch(e){s(e)}}function r(a){try{l(n.throw(a))}catch(e){s(e)}}function l(a){var e;a.done?i(a.value):((e=a.value)instanceof t?e:new t(function(a){a(e)})).then(u,r)}l((n=n.apply(a,e||[])).next())})},__importDefault=this&&this.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(exports,"__esModule",{value:!0});const database_1=__importDefault(require("../config/database")),AkunKeuangan_1=__importDefault(require("../models/AkunKeuangan")),TransaksiDetail_1=__importDefault(require("../models/TransaksiDetail"));function generateNeraca(a,e){return __awaiter(this,void 0,void 0,function*(){try{let a=yield AkunKeuangan_1.default.findAll({attributes:["kode_akun","nama_akun","saldo_awal",],include:[{model:TransaksiDetail_1.default,attributes:[[database_1.default.fn("SUM",database_1.default.literal("CASE WHEN `TransaksiDetails`.`tipe_transaksi` = 'debit' THEN `TransaksiDetails`.`jumlah` ELSE 0 END")),"debit",],[database_1.default.fn("SUM",database_1.default.literal("CASE WHEN `TransaksiDetails`.`tipe_transaksi` = 'kredit' THEN `TransaksiDetails`.`jumlah` ELSE 0 END")),"kredit",],],where:{kode_akun:database_1.default.col("AkunKeuangan.kode_akun")},required:!1},],group:["AkunKeuangan.kode_akun","AkunKeuangan.nama_akun","AkunKeuangan.saldo_awal"],raw:!0,nest:!0}),t=a.map(a=>({kode_akun:a.kode_akun,nama_akun:a.nama_akun,saldo_awal:a.saldo_awal,debit:a["transaksi_details.debit"]||0,kredit:a["transaksi_details.kredit"]||0,saldo_akhir:a.saldo_awal+(a["transaksi_details.debit"]||0)-(a["transaksi_details.kredit"]||0)}));e.status(200).json({neraca:t})}catch(n){e.status(500).json({error:n.message})}})}exports.default={generateNeraca};
